<?xml version="1.0" encoding="UTF-8" ?>
<!DOCTYPE mapper
  PUBLIC "-//mybatis.org//DTD Mapper 3.0//EN"
  "http://mybatis.org/dtd/mybatis-3-mapper.dtd">
<!-- 保证唯一性 使用接口方式加载命名空间 使用代理模式 -->
<mapper namespace="com.znsd.client.dao.ClientResourceMapperDao">

	<resultMap type="java.util.HashMap" id="clientResourceMap">
		<id column="client_id" property="clientId" />
		<result column="client_name" property="clientName" />
		<result column="sex" property="sex" />
		<result column="birthday" property="birthday" />
		<result column="client_type" property="clientType" />
		<result column="state" property="state" />
		<result column="phone" property="phone" />
		<result column="work_phone" property="workPhone" />
		<result column="email" property="email" />
		<result column="family_phone" property="familyPhone" />
		<result column="contact_address" property="contactAddress" />
		<result column="remark" property="remark" />
		<result column="allot_state" property="allotState" />
		<result column="in_time" property="inTime" />
		<result column="staff_name" property="staffName" />
	</resultMap>
	<select id="selectAllClientByPage" resultMap="clientResourceMap">
		SELECT c.client_id,c.client_name,c.sex,c.birthday,c.client_type,c.state,c.phone,c.work_phone,c.email,c.family_phone,c.contact_address,c.remark,c.allot_state,c.in_time,s.staff_name from client_resource
		c INNER JOIN staff s ON c.entry_person = s.staff_id
		<where>
			<choose>
				<when test="allotState != null and allotState gt 0">
					c.allot_state = #{allotState}
					<if test="conditionName != null and conditionName != '' and condition != null and condition != ''">
						and c.${conditionName} = #{condition}
					</if>
				</when>
				<when test="conditionName != null and conditionName != '' and condition != null and condition != ''">
					c.${conditionName} = #{condition}
				</when>
			</choose>
		</where>
	</select>

	<insert id="addResource" parameterType="com.znsd.client.bean.ClientResource">
		INSERT INTO `client_resource`
		(client_id,client_name,phone,work_phone,email,birthday,family_phone,in_time,entry_person,sex,client_type,allot_state,contact_address,remark,state,consumption_times,total_consumption_amount)
		VALUES(null,#{clientName},#{phone},#{workPhone},#{email},#{birthday},#{familyPhone},#{inTime},1,#{sex},#{clientType},1,#{contactAddress},#{remark},1,#{consumptionTimes},#{totalConsumptionAmount})
	</insert>

</mapper>